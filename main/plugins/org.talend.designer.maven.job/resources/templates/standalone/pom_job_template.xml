<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
	<modelVersion>4.0.0</modelVersion>
	<parent>
		<groupId>@ProjectGroupId@</groupId>
		<artifactId>@ProjectArtifactId@</artifactId>
		<version>@ProjectVersion@</version>
		<relativePath>@ProjectRelativePath@</relativePath>
	</parent>
	<groupId>@JobGroupId@</groupId>
	<artifactId>@JobArtifactId@</artifactId>
	<version>@JobVersion@</version>
	<name>@ProjectName@ @JobName@-@JobVersion@ (@TalendJobVersion@,@JobType@)</name>

	<properties>
		<talend.job.path>@JobPath@</talend.job.path>
		<!-- for jobInfo.properties -->
		<maven.build.timestamp.format>@JobDateFormat@</maven.build.timestamp.format>
		<talend.project.name>@ProjectName@</talend.project.name>
		<talend.project.name.lowercase>@ProjectName@</talend.project.name.lowercase>
		<talend.routine.groupid>@RoutineGroupId@</talend.routine.groupid>
		<talend.pigudf.groupid>@PigudfGroupId@</talend.pigudf.groupid>
		<talend.project.id>@ProjectId@</talend.project.id>
		<talend.job.name>@JobName@</talend.job.name>
		<talend.job.version>@TalendJobVersion@</talend.job.version>
		<talend.job.date>${maven.build.timestamp}</talend.job.date>
		<talend.job.context>@JobContext@</talend.job.context>
		<talend.job.id>@JobId@</talend.job.id>
		<talend.job.parent.id>@JobParentId@</talend.job.parent.id>
		<talend.job.type>@JobType@</talend.job.type>
		<talend.job.folder>@JobFolder@</talend.job.folder>
		<talend.job.framework>@Framework@</talend.job.framework>
		<talend.job.stat>@JobStat@</talend.job.stat>
		<talend.job.applyContextToChildren>@JobApplyContextToChildren@</talend.job.applyContextToChildren>
		<talend.product.version>@ProductVersion@</talend.product.version>
		<talend.job.finalName>@JobFinalName@</talend.job.finalName>
		<!-- for global properties -->
		<current.int-resources.dir>${basedir}/src/main/resources</current.int-resources.dir>
		<output.resources.dir>${talend.job.name}/src/main/resources</output.resources.dir>
		<current.resources.dir>${basedir}/src/main/ext-resources</current.resources.dir>
		<current.bundle.resources.dir>${basedir}/src/main/bundle-resources</current.bundle.resources.dir>
		<current.test.resources.dir>${basedir}/src/test/resources</current.test.resources.dir>
	</properties>

	<dependencies>
		<!-- Add some dependencies jars -->
	</dependencies>

	<build>
		<finalName>${talend.job.finalName}</finalName>
	</build>
	<profiles>
		<profile>
			<id>packaging-and-assembly</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<build>
				<plugins>
					<plugin>
						<groupId>org.apache.maven.plugins</groupId>
						<artifactId>maven-assembly-plugin</artifactId>
						<executions>
							<execution>
								<phase>package</phase>
								<goals>
									<goal>single</goal>
								</goals>
								<configuration>
									<descriptors>
										<descriptor>${basedir}/src/main/assemblies/assembly.xml</descriptor>
									</descriptors>
									<tarLongFileMode>gnu</tarLongFileMode>
									<appendAssemblyId>false</appendAssemblyId>
									<finalName>${talend.job.finalName}</finalName>
								</configuration>
							</execution>
						</executions>
					</plugin>
				</plugins>
			</build>
		</profile>
		<profile>
			<id>signature</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<build>
				<plugins>
					<plugin>
						<groupId>org.talend.ci</groupId>
						<artifactId>signer-maven-plugin</artifactId>
						<version>${signer.version}</version>
						<executions>
							<execution>
								<id>sign</id>
								<phase>package</phase>
								<goals>
									<goal>sign</goal>
								</goals>
							</execution>
						</executions>
						<dependencies>
							<dependency>
				              	<groupId>commons-codec</groupId>
								<artifactId>commons-codec</artifactId>
								<version>1.15</version>
				            </dependency>
						</dependencies>
					</plugin>
				</plugins>
			</build>
		</profile>
		<profile>
			<id>default-settings</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<properties>
				<!-- by default, all excluded, fixing that when "include-libs" profile
					is not active, export the libraries always. -->
				<talend.libraries.excludes.set>*:*</talend.libraries.excludes.set>
				<talend.jobs.excludes.set>*:*</talend.jobs.excludes.set>
			</properties>
		</profile>
		<profile>
			<id>include-java-sources</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<properties>
				<sourcecodes.dir>${project.build.sourceDirectory}</sourcecodes.dir>
				<resources.dir>${current.resources.dir}/</resources.dir>
			</properties>
		</profile>
		<profile>
			<id>include-maven-resources</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<properties>
				<templates.dir>${basedir}/src/main/templates/</templates.dir>
				<assemblies.dir>${basedir}/src/main/assemblies/</assemblies.dir>
				<poms.dir>${basedir}</poms.dir>
				<parentpom.dir>${project.parent.relativePath}</parentpom.dir>
				<routinespom.dir>${parentpom.dir}code/routines/</routinespom.dir>
				<routinescode.dir>${parentpom.dir}code/routines/src/main/</routinescode.dir>
				<pigudfpom.dir>${parentpom.dir}code/pigudf/</pigudfpom.dir>
				<pigudfcode.dir>${parentpom.dir}code/pigudf/src/main/</pigudfcode.dir>
				<joblet.dir>${parentpom.dir}jobs/</joblet.dir>
			</properties>
		</profile>
		<profile>
			<id>include-items</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<properties>
				<items.dir>${basedir}/src/main/items/${project.build.finalName}</items.dir>
			</properties>
		</profile>
		<profile>
			<id>include-libs</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<properties>
				<talend.libraries.excludes.set>${talend.libraries.includes.set}</talend.libraries.excludes.set>
				<talend.jobs.excludes.set>${project.groupId}:*</talend.jobs.excludes.set>
				<talend.code.excludes.set>org.talend.code.${talend.project.name.lowercase}:*</talend.code.excludes.set>
				<talend.pigudf.excludes.set>org.talend.pigudf.${talend.project.name.lowercase}:*</talend.pigudf.excludes.set>
				<talend.libraries.includes.set>org.talend.libraries:*</talend.libraries.includes.set>
				<current.job.binaries.include>${project.groupId}:${project.artifactId}:${project.version}</current.job.binaries.include>
			</properties>
		</profile>
		<profile>
			<id>include-binaries</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<properties>
				<jobs.binaries.includes.set>${project.groupId}:*</jobs.binaries.includes.set>
				<routines.binaries.includes.set>${talend.routine.groupid}:*</routines.binaries.includes.set>
			</properties>
		</profile>
		<profile>
			<id>include-xmlMappings</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<properties>
				<xmlMappings.resources.dir>${current.resources.dir}/xmlMappings/</xmlMappings.resources.dir>
			</properties>
		</profile>
		<profile>
			<id>include-running-xmlMappings</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<properties>
				<xmlMappings.running.dir>
					${current.resources.dir}/xmlMappings/
				</xmlMappings.running.dir>
			</properties>
		</profile>
		<profile>
			<id>include-rules</id>
			<properties>
				<rules.resources.dir>${current.resources.dir}/rules/</rules.resources.dir>
			</properties>
		</profile>
		<profile>
			<id>include-log4j</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<properties>
				<log4j.resources.dir>${current.resources.dir}/</log4j.resources.dir>
			</properties>
		</profile>
		<profile>
			<id>include-running-log4j</id>
			<properties>
				<log4j.running.dir>${current.resources.dir}/</log4j.running.dir>
			</properties>
		</profile>
		<profile>
			<id>include-contexts</id>
			<activation>
				<activeByDefault>true</activeByDefault>
			</activation>
			<properties>
				<contexts.running.dir>${current.resources.dir}/</contexts.running.dir>
			</properties>
		</profile>
		<profile>
			<id>include-test-sources</id>
			<properties>
				<test.sourcecodes.dir>${project.build.testSourceDirectory}</test.sourcecodes.dir>
				<test.resources.dir>${basedir}/src/test/resources/</test.resources.dir>
			</properties>
		</profile>
		<profile>
			<id>include-test-reports</id>
			<properties>
				<test.reports.dir>${project.build.directory}/surefire-reports</test.reports.dir>
			</properties>
		</profile>
		<profile>
			<id>include-pigudfs-binaries</id>
			<properties>
				<pigudfs.binaries.includes.set>${talend.pigudf.groupid}:*</pigudfs.binaries.includes.set>
			</properties>
		</profile>

		<profile>
			<id>include-microservice-configs</id>
			<properties>
				<microservice.configs.dir>${current.resources.dir}/</microservice.configs.dir>
			</properties>
		</profile>

		<profile>
			<id>include-microservice-running-configs</id>
			<properties>
				<microservice.running.configs.dir>${current.int-resources.dir}/</microservice.running.configs.dir>
			</properties>
		</profile>

		<profile>
			<id>include-microservice-em-dependencies</id>
			<activation>
				<property>
					<name>studio.prometheus.metrics</name>
					<value>true</value>
				</property>
			</activation>
			<properties>
				<contexts.running.dir>${current.resources.dir}/</contexts.running.dir>
				<microservice.configs.dir>${current.resources.dir}/</microservice.configs.dir>
				<microservice.running.configs.dir>${current.int-resources.dir}/</microservice.running.configs.dir>
			</properties>
			<build>
			    <plugins>
			        <plugin>
			            <artifactId>maven-assembly-plugin</artifactId>
			            <executions>
			                <execution>
			                    <phase>package</phase>
			                    <goals>
			                        <goal>single</goal>
			                    </goals>
			                    <configuration>
			                        <descriptors>
			                            <descriptor>${basedir}/src/main/assemblies/assembly.xml</descriptor>
			                        </descriptors>
			                        <tarLongFileMode>gnu</tarLongFileMode>
			                        <appendAssemblyId>false</appendAssemblyId>
			                        <finalName>${talend.job.finalName}</finalName>
			                    </configuration>
			                </execution>
			            </executions>
			        </plugin>
			    </plugins>
			</build>
		</profile>
		<profile>
		    <id>include-microservice-prometheus-dependencies</id>
		    <activation>
		        <property>
		            <name>studio.prometheus.metrics</name>
		            <value>true</value>
		        </property>
		    </activation>
		    <dependencies>
		        <dependency>
		            <groupId>io.micrometer</groupId>
		            <artifactId>micrometer-registry-prometheus</artifactId>
		            <version>1.8.0</version>
		            </dependency>
		        <dependency>
		            <groupId>io.prometheus.jmx</groupId>
		            <artifactId>collector</artifactId>
		            <version>0.16.1</version>
		        </dependency>
		        <dependency>
		            <groupId>org.springframework.boot</groupId>
		            <artifactId>spring-boot-starter-security</artifactId>
		            <version>2.6.8</version>
		        </dependency>
		    </dependencies>
		</profile>
	</profiles>
</project>
